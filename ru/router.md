#Router 

```js
import { createApp, createRouter } from 'lesta'
const root = document.querySelector('#root')
import routes from  './routes'

const app = createApp()
const router = createRouter(app, {
    routes,
    // layouts: {},
    // beforeEach() {},
    // afterEach() {},
    // beforeEnter() {}, 
    // afterEnter() {}
})
router.init(root)
```

Функция createRouter создает маршрутизатор для SPA приложений.

Параметры:
- Объект приложения, который возвращается в результате вызова функции createApp()
- Опции роутера: layouts, routes, afterEach, beforeEach, beforeEnter, afterEnter. Из них обязательным является только `routes`.

**"router" attribute**
Компонент страницы монтируется в тег который имеет атрибут **router**. Такой тег может находиться либо в index.html, либо в template компонента макета.

**"link" attribute**
Чтобы сделать ссылку для SPA приложения, которая не будет перегружать страницу, необходимо в теге ссылки <a href=”/foo” link>Foo</a> указать атрибут **link**. Относительный путь указанный в href будет используется роутером для перехода к нужному маршруту.

## Layouts
```js
const router = createRouter({
  routes,
  layouts: {
    default: () => import('../layouts/default.js'),
    main: () => import('../layouts/main.js')
  }
})
```

Опция layouts ожидает объект, свойствами которого являются имена макетов, а значениями функции с динамическим импортом компонентов этих макетов. Layout компонент это общий компонент, в который встраивается компонент страницы. 

defaultLayout

## Routes
```js
const router = createRouter({
  routes: [{ 
    path: '/',
    name: 'home',
    component: () => import('../pages/home') 
   }]
})
```
Это свойство ожидает массив с опциями маршрутов. Маршруты описанные ниже имеют больший приоритет. Если url будет соответствовать нескольким маршрутам, активным станет последний в массиве. Объект каждого маршрута поддерживает следующие опции:

## path
```js
path: '/:locale'
```
Определяет путь для маршрута. Может содержать динамические сегменты, начинающиеся с :, которые будут извлечены как параметры маршрута.

## params
```js
path: '/:locale',
  params: {
    locale: {
      regex: /^[a-z]{2}$/,
      optional: true
    }
  }
```
Позволяет задать дополнительные опции для динамических сегментов. Например, можно указать регулярное выражение для проверки значения параметра или сделать параметр необязательным.

## alias
```js
path: '/',
alias: ['/home'],
```
Позволяет задать альтернативные пути для маршрута. Например, маршрут "/" может быть доступен и по пути "/home".

## redirect
```js
path: '/en',
redirect: '/',
```
Перенаправляет запрос на другой маршрут. Может быть строкой или функцией, которая принимает параметры to и from и возвращает путь для перенаправления.


## name
```js
name: 'home'
```
Уникальное имя маршрута, которое можно использовать для навигации вместо пути.

## layout
```js
layout: 'main'
```
Имя макета, указанного в объекте layouts как свойство. 

## component
```js
component: () => import('../pages/home/index.js')
```
Объект компонента, который будет монтироваться при смене маршрута. Может быть динамически импортирован.


## extra
```js
extra: {
  requiresAuth: true
}
```
Используется для хранения дополнительной информации, связанной с маршрутом. Все свойства этого объекта будут доступны только для чтения.


## children
```js
  path: '/:locale',
  children: [{
      path: '/',
      component: () => import('../pages/home'),
    }, {
      path: '/about',
      component: () => import('../pages/about')
    }]
```

Это свойство используется для создания вложенных маршрутов. Свойства path дочерних и родительский маршрутов соединяются вместе. Свойства params и extra родительских маршрутов, посредством слияния добавляются к свойствам дочерних. 

> Функции beforeEnter или afterEnter дочерних маршрутов наследуются от родительких.


## Route Refresh
```js
// in components
refreshed({ cause }) {
    if (cause  === 'routerPushed') {...}
}
```
Есть несколько случаев изменения маршрута, которые вызывают функции жизненного цикла refreshed во всех компонентах с указанием причины в поле cause:

- `routerPushed`: Если при изменении маршрута компонент (layout или page) остается прежним.
- `pageChanged`: Если при изменении маршрута изменился компонент страница.

> Сравнение компонентов происходит, как сравнение ссылок объектов. Поэтому если нужно один и тот же компонент импортировать динамические нужно создать отдельную функцию импорта и передать ее в качестве значения для свойств layout или component.

> refreshed вызывается не только в компоненте макета или страницы, но и  во всех дочерних компонентах.

## Router Lifecycle Functions

Функции жизненного цикла доступны в опциях роутера и в опциях каждого отдельного маршрута.  Во всех функциях можно использовать асинхронные операции с использованием await.

Параметры:
- `to` объект созданный в результате изменения маршрута.  
- `from` объект предыдущего изменения маршрута если оно было.
- `app` объект приложения, полученный первым аргументом в функции createRouter.
 

## beforeEach
```js
const router = createRouter({
    beforeEach(to, from, app) {
        // check login
    }
   …
})
```
Описывается только в опциях роутера. Вызывается при каждом обращении к роутеру до обработки всех маршрутов массива routes.

## afterEach
```js
const router = createRouter({
    afterEach(to, from, app) {
        if (!to.path) {
	// some code
	return '/404'
        }
    },
    …
})
```
Описывается только опциях роутера. Вызывается при каждом обращении к роутеру после обработки всех маршрутов массива routes. Вызывается даже, если маршрут не найден.

## beforeEnter
```js
beforeEnter: async (to, from, app) => {
  if (!app.user.isAuthenticated) {
    return { path: '/login' };
  }
}
```
Эта функция может быть описана, как в опция роутера, так и в опцих маршрута. Вызывается до монтирования компонента соответствующего маршруту.

## afterEnter
```js
afterEnter: (to, from, app) => {
  // route completed
}
```
Эта функция может быть описана, как в опция роутера, так и в опцих маршрута. Вызывается после монтирования компонента соответствующего маршруту.


# Router in Component

Методы роутера вызываются в компонентах, и являются частью объекта this.app.router.

Свойства:
- `to`: Объект созданный в результате изменения маршрута.  
- `from`: Объект предыдущего изменения маршрута если оно было.
- `link`, `push`: Дополнительные методы.

## link
```js
nodes() {
  return {
    home: {
      href: () => this.router.link({ name: ‘home’, params: { locale:  this.proxy.locale } })
    }
…
```
Метод link по заданным параметрам ищет соответствующий маршрут в массиве routes и возвращает новый путь. В качестве аргумента может принимать либо строку либо объект. Если передать строку то метод будет интерпретировать значение как путь маршрута. 
Свойства:
- `path`: Значение этого параметра используется как конечный путь. path с символом ‘/’ в начале строки будет определяется как внутренняя ссылка, без него, как внешняя.

- `name`: Значение этого параметра ищет соответствующий маршрут по имени в массиве routes. Этот параметр игнорируется если указан параметр **path**. Если маршрут имеет обязательные параметры, то соответствующие им новые значения  должны быть указаны в **params**
	
- `params`: Меняет параметры текущего маршрута. Если свойство отсутствует  pathname останется текущим.

- `query`: Если свойств нет, удаляет, если есть добавляет. Если вы хотите оставить параметры в url, необходимо передать пустой объект, иначе параметры пропадут.

- `hash`: Добавляет или меняет хеш в url.

> Значения params и search проходять через проверку безопасного контента, если содержимое определено как небезопасное, то значения будут кодированы через encodeURIComponent.

> Если path и name не указаны, то параметры будут применяться к строке текущего url браузера.

## push
```js
    nodes() {
    return {
      en: {
        onclick: () => this.router.push({ params: { locale: 'en' }, replace: true})
      },
…
```
Метод осуществляет изменение маршрута по заданным параметрам.

Параметры:
Полностью дублирует параметры метода link.
Объект, передаваемый в качестве аргумента поддерживает дополнительные свойства state, target, windowFeatures. 

**state**
Объект используется для передачи дополнительных данных перехода. Все свойства этого объекта проходят сериализацию. Зарезервированные свойства:
- `replaced` (belean): Если значение true история навигации будет не добавлена, а перезаписана, аналогично history.replace.
- `reloaded` (belean): Значение, если значение true компонент страницы будем перемонтирован.
- `top` (число): Указывает количество пикселей по оси Y для прокрутки окна.
- `left` (число): Указывает количество пикселей по оси X для прокрутки окна.
- `behavior`  (строка): Определяет, будет ли прокрутка мгновенной или плавно анимированной. Этот параметр представляет собой строку, которая должна принимать одно из следующих значений:
smooth: прокрутка должна анимироваться плавно
instant: прокрутка должна происходить мгновенно за один прыжок
auto: поведение прокрутки определяется вычисленным значением [scroll-behavior](https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-behavior)

**target & windowFeatures**
Если свойство path не начинается с символа ‘/’ то ссылка будет определяться, как на внешняя. В этом случае push может принимать дополнительные параметры (target, windowFeatures) как у нативнрго метода window.open() [https://developer.mozilla.org/en-US/docs/Web/API/Window/open]

Возвращаемые значения:
Объект **to** после обработки маршрута и загрузки компонентов.

> Если в url присутствует хеш то до элемента с соответствующим id будет произведен скролл страницы (принцип якоря), с учетом параметров state: top, left, behavior.

> Если маршрут не найден, то переход будет по “/”

> Для анимированная навигации можно использовать нативный View Transitions API [https://developer.mozilla.org/en-US/docs/Web/API/View_Transition_API]

> Для перемещения по относительному положению в истории можно использовать нативный метод history.go() [https://developer.mozilla.org/ru/docs/Web/API/History/go]

