#Router

```js
import { createApp, createRouter } from 'lesta'
const root = document.querySelector('#root')
import routes from  './routes'

const router = createRouter({
    beforeEach() {},
    afterEach() {},
    routes
})

const app = createApp({
    root,
    router
})
```

Чтобы создать роутер, в функцию createRouter необходимо передать объект со свойством routes. Значением этого свойства должен быть массив маршрутов. Каждый маршрут это набор опции, представленый в виде объекта.

Функция createRouter также как и createApp импортируется из модуля 'lesta'

Объект который вернет функция createRouter необходимо передать в объект аргумента createApp с ключом router.


# Route options
Обработка маршрутов работает по принципу каскадов. Маршруты описанные ниже имеют больший приоритет. Таким образом, если несколько маршрутов соотвуют одному пути, будет выбран последний в массиве.

# path
```js
path: '/:locale'
```

# params
```js
path: '/:locale',
  params: {
    locale: {
      regex: /^[a-z]{2}$/,
      optional: true
    }
  }
```

# alias
```js
path: '/',
alias: ['/home'],
```

# redirect
```js
path: '/en',
redirect: '/',
```
может быть функцией v(to, from)


# children
```js
  path: '/:locale',
  children: [{
      path: '/',
      component: () => import('../pages/home'),
    }, {
      path: '/about',
      component: () => import('../pages/about')
    }]
```
Поддерживается любой уровень вложенности.


# name
```js
name: 'home'
```

# component
```js
component: () => import('../pages/home')
```

# static
не используется template

# extra
extras
Object.freeze()
один уровень вложенности

# Hooks router

unmount(to, from)

# beforeEach
```js
const router = createRouter({
    beforeEach(_, from) {
        // check login
    }
    routes
})
```
Асинхронный хук, описывается в объекте аргумента функции createRouter. Вызывается при каждом вызове роутера до обработки массива routes.

# afterEach
```js
const router = createRouter({
    afterEach(to, from) {
        if (!to.path) return '/404'
    },
    routes
})
```
Асинхронный хук, описывается в опциях функции createRouter. Вызывается при каждом вызове роутера после обработки массива routes. Даже если маршрут не найден

# beforeEnter
```js

```
Асинхронный хук, вызывается до монтирования компонента страницы соответствующего маршруту. Данный хук вызывается в роутере и в сторе и в опциях роутера. Если нужно отследить в компоненте уход со страницы можно использовать обычный хук компонента unmounted

# afterEnter
```js

```
Асинхронный хук, вызывается после монтирования компонента страницы соответствующего маршруту. Данный хук вызывается в опциях роутера и в store и в опциях роутера.

# routeUpdate

Обновляется при монтировании и при обновлении маршрута (from.path === to.path) или если layout остался прежним


# Methods

## link
```js
    nodes() {
    return {
      home: {
        href: () => this.router.link({ name: ‘home’, params: { locale:  this.proxy.locale } })
      }
…
```
Метод link по заданным параметрам ищет соответствующий маршрут в массиве routes и возвращает новый путь. В качестве аргумента может принимать либо строку либо объект. Если передать строку то метод будет интерпретировать значение как путь маршрута. Для объекта предусмотрены следующие опции:

**path** значение этого параметра используется как конечный путь. Если этот параметр является результатом пользовательского ввода, то используйте encodeURI для кодирования этого значения для избежания xss уязвимости.

**name** значение этого параметра ищет соответствующий маршрут по имени в массиве routes. Этот параметр игнорируется если указан параметр **path**. Если маршрут имеет обязательные параметры, то соответствующие им новые значения  должны быть указаны в **params**

**params** меняет параметры текущего маршрута. Если свойство отсутствует  pathname останется текущим.

**search** если свойств нет, удаляет, если есть добавляет. Если вы хотите оставить параметре в строку, необходимо передать пустой объект, иначе свойства пропадут.

> Если path и name не указаны, то значения params и search, будут меняться в текущем url браузера

> значения params и search проходять через проверку безопасного контента, если содержимое определено как небезопасное, то значения будут кодированы через encodeURIComponent

> Если **path** или **name** не указаны, то изменения будут применяться к текущему url браузера.

## push
```js
    nodes() {
    return {
      en: {
        onclick: () => this.router.push({ params: { locale: 'en' }, replace: true})
      },
…
```
Метод push работает аналогично методу link, только еще дополнительно осуществляет изменение маршрута. Объект передаваемый в качестве аргумента может использовать дополнительное свойство:

**replace**
belean значение, если значение true история навигации будет перезаписана, аналогично history.replace

> push функция является асинхронной, возвращает новый путь после обработки маршрутов и загрузки компонентов.

> Если соответствующий маршрут не будет найден, то переход будет по “/”

## go
```js
    nodes() {
    return {
      back: {
        onclick: () => this.router.go(-1)
      },
…
```
Вызывается в компоненте как this.router.go(). Работает аналогично нативному javascript методу history.go()

## layout
```js
import main from '../../layouts/main'

export default {
  template: `<div class="content">home</div>`,
  layout: main
}
```
Роутер предоставляет возможность использования макетов. Макетом является обычный компонент в который встраивается компонент страницы. Чтобы указать макет в который должна встраиваться страница, в опцию layout компонента страницы необходимо передать файл компонента макета. В template компонента layout должен быть тег с атрибутом **router** в который будет монтирован компонент страницы (см. ниже)

## Attributes

```js
   <div class="wrapper" router></div>
```

```js
   <a href=”/” link>Home</a>
```

Атрибут **router** устанавливается для тега в который необходимо монтировать компонент роутера. Такой тег может находиться либо в корневом узле root, либо в template компонента layout.

Атрибут **link** устанавливается для тега <a>. Он позволяет блокировать стандартное поведение перехода по ссылке. Путь указанный в href используется роутером для поиска нужного маршрута в массиве routes.

